import{o as e,a as t,u as r,v as a,O as o}from"./worker-entry-BFFzWMHV.js";import{p as n,d as s,G as i,D as l,w as c,r as d,L as u,H as p,C as h,T as m,a as g,c as f,I as x,b as v,e as w,u as y,R as b,f as j,g as N,h as k,i as S,P as C,V as I,A as P,j as R,k as _,l as T,m as D,n as E,o as M,q as L,s as z,x as F,t as O,v as A,U as $,y as H,B,F as V,z as K,E as W,J as q,K as U,M as Q,N as G,O as J,Q as X,S as Y}from"./router-DwtiA2Gk.js";import{u as Z,c as ee,a as te,h as re,b as ae,R as oe,F as ne,d as se}from"./Combination-C902bN5t.js";import{u as ie}from"./useInfiniteQuery-BEV3g9Lt.js";import"node:events";import"node:stream";import"node:async_hooks";import"node:stream/web";import"./fetcher-C0qtPk9m.js";import"./useBaseQuery-BHUKrbBs.js";const le=[{label:"Front Page",href:"/top",icon:n,showMobile:!0},{label:"New",href:"/new",icon:s,showMobile:!0},{label:"Best",href:"/best",icon:i,showMobile:!0},{label:"Job",href:"/job",icon:l,showMobile:!0},{label:"Ask",href:"/ask",icon:c,showMobile:!0},{label:"Show",href:"/show",icon:d,showMobile:!0}];function ce({category:t,postId:r,isLoadingCategory:a}){return e.jsxs("nav",{className:"flex-1 space-y-2 p-2",children:[e.jsx(u,{className:"flex cursor-default items-center gap-3 rounded-lg bg-sky-600 p-2 text-gray-700 text-white transition-colors hover:bg-sky-700/90 dark:bg-sky-800 dark:text-gray-200 dark:hover:bg-sky-800/90",params:{category:t},search:e=>e,state:e=>({...e,view:"post"}),to:"/$category",children:e.jsx(p,{className:"h-5 w-5",icon:h})}),le.map(o=>{const n=o.href.split("/")[1];return e.jsxs(m,{children:[e.jsx(g,{asChild:!0,children:e.jsx(u,{"aria-busy":Boolean(a&&`/${a}`===o.href),"aria-current":`/${t}`===o.href?"page":void 0,"aria-label":o.label,className:f("flex items-center gap-3 rounded-lg p-2 text-gray-700 transition-colors hover:bg-zinc-100 dark:text-gray-200 dark:hover:bg-orange-800/50",`/${t}`===o.href&&"bg-orange-200 text-orange-700 hover:bg-orange-200 dark:bg-orange-800 dark:text-orange-300 dark:hover:bg-orange-800"),params:{category:"search"===n?t:n,postId:"search"===n?void 0:r},resetScroll:!1,search:e=>e,state:e=>({...e,view:"nav"}),to:r.length>0?"/$category/$postId":o.href,children:`/${a}`===o.href?e.jsx(p,{className:"h-5 w-5 animate-spin",icon:x}):e.jsx(p,{className:f("h-5 w-5"),icon:o.icon})})}),e.jsx(v,{side:"right",children:e.jsx("p",{children:o.label})})]},o.href)})]})}function de(e,[t,r]){return Math.min(r,Math.max(t,e))}var ue=[" ","Enter","ArrowUp","ArrowDown"],pe=[" ","Enter"],he="Select",[me,ge,fe]=ee(he),[xe,ve]=j(he,[fe,w]),we=w(),[ye,be]=xe(he),[je,Ne]=xe(he),ke=r=>{const{__scopeSelect:a,children:o,open:n,defaultOpen:s,onOpenChange:i,value:l,defaultValue:c,onValueChange:d,dir:u,name:p,autoComplete:h,disabled:m,required:g,form:f}=r,x=we(a),[v,w]=t.useState(null),[j,k]=t.useState(null),[S,C]=t.useState(!1),I=Z(u),[P,R]=y({prop:n,defaultProp:s??!1,onChange:i,caller:he}),[_,T]=y({prop:l,defaultProp:c,onChange:d,caller:he}),D=t.useRef(null),E=!v||(f||!!v.closest("form")),[M,L]=t.useState(new Set),z=Array.from(M).map(e=>e.props.value).join(";");return e.jsx(b,{...x,children:e.jsxs(ye,{required:g,scope:a,trigger:v,onTriggerChange:w,valueNode:j,onValueNodeChange:k,valueNodeHasChildren:S,onValueNodeHasChildrenChange:C,contentId:N(),value:_,onValueChange:T,open:P,onOpenChange:R,dir:I,triggerPointerDownPosRef:D,disabled:m,children:[e.jsx(me.Provider,{scope:a,children:e.jsx(je,{scope:r.__scopeSelect,onNativeOptionAdd:t.useCallback(e=>{L(t=>new Set(t).add(e))},[]),onNativeOptionRemove:t.useCallback(e=>{L(t=>{const r=new Set(t);return r.delete(e),r})},[]),children:o})}),E?e.jsxs(dt,{"aria-hidden":!0,required:g,tabIndex:-1,name:p,autoComplete:h,value:_,onChange:e=>T(e.target.value),disabled:m,form:f,children:[void 0===_?e.jsx("option",{value:""}):null,Array.from(M)]},z):null]})})};ke.displayName=he;var Se="SelectTrigger",Ce=t.forwardRef((r,a)=>{const{__scopeSelect:o,disabled:n=!1,...s}=r,i=we(o),l=be(Se,o),c=l.disabled||n,d=k(a,l.onTriggerChange),u=ge(o),p=t.useRef("touch"),[h,m,g]=pt(e=>{const t=u().filter(e=>!e.disabled),r=t.find(e=>e.value===l.value),a=ht(t,e,r);void 0!==a&&l.onValueChange(a.value)}),f=e=>{c||(l.onOpenChange(!0),g()),e&&(l.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return e.jsx(P,{asChild:!0,...i,children:e.jsx(C.button,{type:"button",role:"combobox","aria-controls":l.contentId,"aria-expanded":l.open,"aria-required":l.required,"aria-autocomplete":"none",dir:l.dir,"data-state":l.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":ut(l.value)?"":void 0,...s,ref:d,onClick:R(s.onClick,e=>{e.currentTarget.focus(),"mouse"!==p.current&&f(e)}),onPointerDown:R(s.onPointerDown,e=>{p.current=e.pointerType;const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(f(e),e.preventDefault())}),onKeyDown:R(s.onKeyDown,e=>{const t=""!==h.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||m(e.key),t&&" "===e.key||ue.includes(e.key)&&(f(),e.preventDefault())})})})});Ce.displayName=Se;var Ie="SelectValue",Pe=t.forwardRef((t,r)=>{const{__scopeSelect:a,className:o,style:n,children:s,placeholder:i="",...l}=t,c=be(Ie,a),{onValueNodeHasChildrenChange:d}=c,u=void 0!==s,p=k(r,c.onValueNodeChange);return S(()=>{d(u)},[d,u]),e.jsx(C.span,{...l,ref:p,style:{pointerEvents:"none"},children:ut(c.value)?e.jsx(e.Fragment,{children:i}):s})});Pe.displayName=Ie;var Re=t.forwardRef((t,r)=>{const{__scopeSelect:a,children:o,...n}=t;return e.jsx(C.span,{"aria-hidden":!0,...n,ref:r,children:o||"â–¼"})});Re.displayName="SelectIcon";var _e=t=>e.jsx(_,{asChild:!0,...t});_e.displayName="SelectPortal";var Te="SelectContent",De=t.forwardRef((r,a)=>{const o=be(Te,r.__scopeSelect),[n,s]=t.useState();if(S(()=>{s(new DocumentFragment)},[]),!o.open){const t=n;return t?T.createPortal(e.jsx(Me,{scope:r.__scopeSelect,children:e.jsx(me.Slot,{scope:r.__scopeSelect,children:e.jsx("div",{children:r.children})})}),t):null}return e.jsx(Fe,{...r,ref:a})});De.displayName=Te;var Ee=10,[Me,Le]=xe(Te),ze=E("SelectContent.RemoveScroll"),Fe=t.forwardRef((r,a)=>{const{__scopeSelect:o,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:i,onPointerDownOutside:l,side:c,sideOffset:d,align:u,alignOffset:p,arrowPadding:h,collisionBoundary:m,collisionPadding:g,sticky:f,hideWhenDetached:x,avoidCollisions:v,...w}=r,y=be(Te,o),[b,j]=t.useState(null),[N,S]=t.useState(null),C=k(a,e=>j(e)),[I,P]=t.useState(null),[_,T]=t.useState(null),D=ge(o),[E,L]=t.useState(!1),z=t.useRef(!1);t.useEffect(()=>{if(b)return re(b)},[b]),ae();const F=t.useCallback(e=>{const[t,...r]=D().map(e=>e.ref.current),[a]=r.slice(-1),o=document.activeElement;for(const n of e){if(n===o)return;if(n?.scrollIntoView({block:"nearest"}),n===t&&N&&(N.scrollTop=0),n===a&&N&&(N.scrollTop=N.scrollHeight),n?.focus(),document.activeElement!==o)return}},[D,N]),O=t.useCallback(()=>F([I,b]),[F,I,b]);t.useEffect(()=>{E&&O()},[E,O]);const{onOpenChange:A,triggerPointerDownPosRef:$}=y;t.useEffect(()=>{if(b){let e={x:0,y:0};const t=t=>{e={x:Math.abs(Math.round(t.pageX)-($.current?.x??0)),y:Math.abs(Math.round(t.pageY)-($.current?.y??0))}},r=r=>{e.x<=10&&e.y<=10?r.preventDefault():b.contains(r.target)||A(!1),document.removeEventListener("pointermove",t),$.current=null};return null!==$.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",r,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",r,{capture:!0})}}},[b,A,$]),t.useEffect(()=>{const e=()=>A(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}},[A]);const[H,B]=pt(e=>{const t=D().filter(e=>!e.disabled),r=t.find(e=>e.ref.current===document.activeElement),a=ht(t,e,r);a&&setTimeout(()=>a.ref.current.focus())}),V=t.useCallback((e,t,r)=>{const a=!z.current&&!r;(void 0!==y.value&&y.value===t||a)&&(P(e),a&&(z.current=!0))},[y.value]),K=t.useCallback(()=>b?.focus(),[b]),W=t.useCallback((e,t,r)=>{const a=!z.current&&!r;(void 0!==y.value&&y.value===t||a)&&T(e)},[y.value]),q="popper"===n?Ae:Oe,U=q===Ae?{side:c,sideOffset:d,align:u,alignOffset:p,arrowPadding:h,collisionBoundary:m,collisionPadding:g,sticky:f,hideWhenDetached:x,avoidCollisions:v}:{};return e.jsx(Me,{scope:o,content:b,viewport:N,onViewportChange:S,itemRefCallback:V,selectedItem:I,onItemLeave:K,itemTextRefCallback:W,focusSelectedItem:O,selectedItemText:_,position:n,isPositioned:E,searchRef:H,children:e.jsx(oe,{as:ze,allowPinchZoom:!0,children:e.jsx(ne,{asChild:!0,trapped:y.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:R(s,e=>{y.trigger?.focus({preventScroll:!0}),e.preventDefault()}),children:e.jsx(M,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:l,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:e.jsx(q,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:e=>e.preventDefault(),...w,...U,onPlaced:()=>L(!0),ref:C,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:R(w.onKeyDown,e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),t||1!==e.key.length||B(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=D().filter(e=>!e.disabled).map(e=>e.ref.current);if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const r=e.target,a=t.indexOf(r);t=t.slice(a+1)}setTimeout(()=>F(t)),e.preventDefault()}})})})})})})});Fe.displayName="SelectContentImpl";var Oe=t.forwardRef((r,a)=>{const{__scopeSelect:o,onPlaced:n,...s}=r,i=be(Te,o),l=Le(Te,o),[c,d]=t.useState(null),[u,p]=t.useState(null),h=k(a,e=>p(e)),m=ge(o),g=t.useRef(!1),f=t.useRef(!0),{viewport:x,selectedItem:v,selectedItemText:w,focusSelectedItem:y}=l,b=t.useCallback(()=>{if(i.trigger&&i.valueNode&&c&&u&&x&&v&&w){const e=i.trigger.getBoundingClientRect(),t=u.getBoundingClientRect(),r=i.valueNode.getBoundingClientRect(),a=w.getBoundingClientRect();if("rtl"!==i.dir){const o=a.left-t.left,n=r.left-o,s=e.left-n,i=e.width+s,l=Math.max(i,t.width),d=window.innerWidth-Ee,u=de(n,[Ee,Math.max(Ee,d-l)]);c.style.minWidth=i+"px",c.style.left=u+"px"}else{const o=t.right-a.right,n=window.innerWidth-r.right-o,s=window.innerWidth-e.right-n,i=e.width+s,l=Math.max(i,t.width),d=window.innerWidth-Ee,u=de(n,[Ee,Math.max(Ee,d-l)]);c.style.minWidth=i+"px",c.style.right=u+"px"}const o=m(),s=window.innerHeight-2*Ee,l=x.scrollHeight,d=window.getComputedStyle(u),p=parseInt(d.borderTopWidth,10),h=parseInt(d.paddingTop,10),f=parseInt(d.borderBottomWidth,10),y=p+h+l+parseInt(d.paddingBottom,10)+f,b=Math.min(5*v.offsetHeight,y),j=window.getComputedStyle(x),N=parseInt(j.paddingTop,10),k=parseInt(j.paddingBottom,10),S=e.top+e.height/2-Ee,C=s-S,I=v.offsetHeight/2,P=p+h+(v.offsetTop+I),R=y-P;if(P<=S){const e=o.length>0&&v===o[o.length-1].ref.current;c.style.bottom="0px";const t=u.clientHeight-x.offsetTop-x.offsetHeight,r=P+Math.max(C,I+(e?k:0)+t+f);c.style.height=r+"px"}else{const e=o.length>0&&v===o[0].ref.current;c.style.top="0px";const t=Math.max(S,p+x.offsetTop+(e?N:0)+I)+R;c.style.height=t+"px",x.scrollTop=P-S+x.offsetTop}c.style.margin=`${Ee}px 0`,c.style.minHeight=b+"px",c.style.maxHeight=s+"px",n?.(),requestAnimationFrame(()=>g.current=!0)}},[m,i.trigger,i.valueNode,c,u,x,v,w,i.dir,n]);S(()=>b(),[b]);const[j,N]=t.useState();S(()=>{u&&N(window.getComputedStyle(u).zIndex)},[u]);const I=t.useCallback(e=>{e&&!0===f.current&&(b(),y?.(),f.current=!1)},[b,y]);return e.jsx($e,{scope:o,contentWrapper:c,shouldExpandOnScrollRef:g,onScrollButtonChange:I,children:e.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:j},children:e.jsx(C.div,{...s,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});Oe.displayName="SelectItemAlignedPosition";var Ae=t.forwardRef((t,r)=>{const{__scopeSelect:a,align:o="start",collisionPadding:n=Ee,...s}=t,i=we(a);return e.jsx(L,{...i,...s,ref:r,align:o,collisionPadding:n,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Ae.displayName="SelectPopperPosition";var[$e,He]=xe(Te,{}),Be="SelectViewport",Ve=t.forwardRef((r,a)=>{const{__scopeSelect:o,nonce:n,...s}=r,i=Le(Be,o),l=He(Be,o),c=k(a,i.onViewportChange),d=t.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(me.Slot,{scope:o,children:e.jsx(C.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:R(s.onScroll,e=>{const t=e.currentTarget,{contentWrapper:r,shouldExpandOnScrollRef:a}=l;if(a?.current&&r){const e=Math.abs(d.current-t.scrollTop);if(e>0){const a=window.innerHeight-2*Ee,o=parseFloat(r.style.minHeight),n=parseFloat(r.style.height),s=Math.max(o,n);if(s<a){const o=s+e,n=Math.min(a,o),i=o-n;r.style.height=n+"px","0px"===r.style.bottom&&(t.scrollTop=i>0?i:0,r.style.justifyContent="flex-end")}}}d.current=t.scrollTop})})})]})});Ve.displayName=Be;var Ke="SelectGroup",[We,qe]=xe(Ke);t.forwardRef((t,r)=>{const{__scopeSelect:a,...o}=t,n=N();return e.jsx(We,{scope:a,id:n,children:e.jsx(C.div,{role:"group","aria-labelledby":n,...o,ref:r})})}).displayName=Ke;var Ue="SelectLabel",Qe=t.forwardRef((t,r)=>{const{__scopeSelect:a,...o}=t,n=qe(Ue,a);return e.jsx(C.div,{id:n.id,...o,ref:r})});Qe.displayName=Ue;var Ge="SelectItem",[Je,Xe]=xe(Ge),Ye=t.forwardRef((r,a)=>{const{__scopeSelect:o,value:n,disabled:s=!1,textValue:i,...l}=r,c=be(Ge,o),d=Le(Ge,o),u=c.value===n,[p,h]=t.useState(i??""),[m,g]=t.useState(!1),f=k(a,e=>d.itemRefCallback?.(e,n,s)),x=N(),v=t.useRef("touch"),w=()=>{s||(c.onValueChange(n),c.onOpenChange(!1))};if(""===n)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(Je,{scope:o,value:n,disabled:s,textId:x,isSelected:u,onItemTextChange:t.useCallback(e=>{h(t=>t||(e?.textContent??"").trim())},[]),children:e.jsx(me.ItemSlot,{scope:o,value:n,disabled:s,textValue:p,children:e.jsx(C.div,{role:"option","aria-labelledby":x,"data-highlighted":m?"":void 0,"aria-selected":u&&m,"data-state":u?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...l,ref:f,onFocus:R(l.onFocus,()=>g(!0)),onBlur:R(l.onBlur,()=>g(!1)),onClick:R(l.onClick,()=>{"mouse"!==v.current&&w()}),onPointerUp:R(l.onPointerUp,()=>{"mouse"===v.current&&w()}),onPointerDown:R(l.onPointerDown,e=>{v.current=e.pointerType}),onPointerMove:R(l.onPointerMove,e=>{v.current=e.pointerType,s?d.onItemLeave?.():"mouse"===v.current&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:R(l.onPointerLeave,e=>{e.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:R(l.onKeyDown,e=>{""!==d.searchRef?.current&&" "===e.key||(pe.includes(e.key)&&w()," "===e.key&&e.preventDefault())})})})})});Ye.displayName=Ge;var Ze="SelectItemText",et=t.forwardRef((r,a)=>{const{__scopeSelect:o,className:n,style:s,...i}=r,l=be(Ze,o),c=Le(Ze,o),d=Xe(Ze,o),u=Ne(Ze,o),[p,h]=t.useState(null),m=k(a,e=>h(e),d.onItemTextChange,e=>c.itemTextRefCallback?.(e,d.value,d.disabled)),g=p?.textContent,f=t.useMemo(()=>e.jsx("option",{value:d.value,disabled:d.disabled,children:g},d.value),[d.disabled,d.value,g]),{onNativeOptionAdd:x,onNativeOptionRemove:v}=u;return S(()=>(x(f),()=>v(f)),[x,v,f]),e.jsxs(e.Fragment,{children:[e.jsx(C.span,{id:d.textId,...i,ref:m}),d.isSelected&&l.valueNode&&!l.valueNodeHasChildren?T.createPortal(i.children,l.valueNode):null]})});et.displayName=Ze;var tt="SelectItemIndicator",rt=t.forwardRef((t,r)=>{const{__scopeSelect:a,...o}=t;return Xe(tt,a).isSelected?e.jsx(C.span,{"aria-hidden":!0,...o,ref:r}):null});rt.displayName=tt;var at="SelectScrollUpButton",ot=t.forwardRef((r,a)=>{const o=Le(at,r.__scopeSelect),n=He(at,r.__scopeSelect),[s,i]=t.useState(!1),l=k(a,n.onScrollButtonChange);return S(()=>{if(o.viewport&&o.isPositioned){let e=function(){const e=t.scrollTop>0;i(e)};const t=o.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[o.viewport,o.isPositioned]),s?e.jsx(it,{...r,ref:l,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=o;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}}):null});ot.displayName=at;var nt="SelectScrollDownButton",st=t.forwardRef((r,a)=>{const o=Le(nt,r.__scopeSelect),n=He(nt,r.__scopeSelect),[s,i]=t.useState(!1),l=k(a,n.onScrollButtonChange);return S(()=>{if(o.viewport&&o.isPositioned){let e=function(){const e=t.scrollHeight-t.clientHeight,r=Math.ceil(t.scrollTop)<e;i(r)};const t=o.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[o.viewport,o.isPositioned]),s?e.jsx(it,{...r,ref:l,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=o;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}}):null});st.displayName=nt;var it=t.forwardRef((r,a)=>{const{__scopeSelect:o,onAutoScroll:n,...s}=r,i=Le("SelectScrollButton",o),l=t.useRef(null),c=ge(o),d=t.useCallback(()=>{null!==l.current&&(window.clearInterval(l.current),l.current=null)},[]);return t.useEffect(()=>()=>d(),[d]),S(()=>{const e=c().find(e=>e.ref.current===document.activeElement);e?.ref.current?.scrollIntoView({block:"nearest"})},[c]),e.jsx(C.div,{"aria-hidden":!0,...s,ref:a,style:{flexShrink:0,...s.style},onPointerDown:R(s.onPointerDown,()=>{null===l.current&&(l.current=window.setInterval(n,50))}),onPointerMove:R(s.onPointerMove,()=>{i.onItemLeave?.(),null===l.current&&(l.current=window.setInterval(n,50))}),onPointerLeave:R(s.onPointerLeave,()=>{d()})})}),lt=t.forwardRef((t,r)=>{const{__scopeSelect:a,...o}=t;return e.jsx(C.div,{"aria-hidden":!0,...o,ref:r})});lt.displayName="SelectSeparator";var ct="SelectArrow";t.forwardRef((t,r)=>{const{__scopeSelect:a,...o}=t,n=we(a),s=be(ct,a),i=Le(ct,a);return s.open&&"popper"===i.position?e.jsx(z,{...n,...o,ref:r}):null}).displayName=ct;var dt=t.forwardRef(({__scopeSelect:r,value:a,...o},n)=>{const s=t.useRef(null),i=k(n,s),l=te(a);return t.useEffect(()=>{const e=s.current;if(!e)return;const t=window.HTMLSelectElement.prototype,r=Object.getOwnPropertyDescriptor(t,"value").set;if(l!==a&&r){const t=new Event("change",{bubbles:!0});r.call(e,a),e.dispatchEvent(t)}},[l,a]),e.jsx(C.select,{...o,style:{...I,...o.style},ref:i,defaultValue:a})});function ut(e){return""===e||void 0===e}function pt(e){const r=D(e),a=t.useRef(""),o=t.useRef(0),n=t.useCallback(e=>{const t=a.current+e;r(t),function e(t){a.current=t,window.clearTimeout(o.current),""!==t&&(o.current=window.setTimeout(()=>e(""),1e3))}(t)},[r]),s=t.useCallback(()=>{a.current="",window.clearTimeout(o.current)},[]);return t.useEffect(()=>()=>window.clearTimeout(o.current),[]),[a,n,s]}function ht(e,t,r){const a=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let n=(s=e,i=Math.max(o,0),s.map((e,t)=>s[(i+t)%s.length]));var s,i;1===a.length&&(n=n.filter(e=>e!==r));const l=n.find(e=>e.textValue.toLowerCase().startsWith(a.toLowerCase()));return l!==r?l:void 0}dt.displayName="SelectBubbleInput";var mt=Ce,gt=Re,ft=_e,xt=De,vt=Ve,wt=Qe,yt=Ye,bt=et,jt=rt,Nt=ot,kt=st,St=lt;const Ct=ke,It=Pe,Pt=t.forwardRef(({className:t,children:r,...a},o)=>e.jsxs(mt,{ref:o,className:f("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...a,children:[r,e.jsx(gt,{asChild:!0,children:e.jsx(p,{icon:F,className:"h-4 w-4 opacity-50"})})]}));Pt.displayName=mt.displayName;const Rt=t.forwardRef(({className:t,...r},a)=>e.jsx(Nt,{ref:a,className:f("flex cursor-default items-center justify-center py-1",t),...r,children:e.jsx(p,{icon:A,className:"h-4 w-4"})}));Rt.displayName=Nt.displayName;const _t=t.forwardRef(({className:t,...r},a)=>e.jsx(kt,{ref:a,className:f("flex cursor-default items-center justify-center py-1",t),...r,children:e.jsx(p,{icon:$,className:"h-4 w-4"})}));_t.displayName=kt.displayName;const Tt=t.forwardRef(({className:t,children:r,position:a="popper",...o},n)=>e.jsx(ft,{children:e.jsxs(xt,{ref:n,className:f("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...o,children:[e.jsx(Rt,{}),e.jsx(vt,{className:f("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),e.jsx(_t,{})]})}));Tt.displayName=xt.displayName;t.forwardRef(({className:t,...r},a)=>e.jsx(wt,{ref:a,className:f("px-2 py-1.5 text-sm font-semibold",t),...r})).displayName=wt.displayName;const Dt=t.forwardRef(({className:t,children:r,...a},o)=>e.jsxs(yt,{ref:o,className:f("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(jt,{children:e.jsx(p,{icon:O,className:"h-4 w-4"})})}),e.jsx(bt,{children:r})]}));Dt.displayName=yt.displayName;function Et({category:t,postId:r,isLoadingCategory:a,view:o}){const n=H();return e.jsxs("div",{className:"flex justify-between gap-3 border-gray-200 border-t bg-white p-2 md:hidden dark:border-zinc-800 dark:bg-zinc-900",children:[e.jsxs(Ct,{onValueChange:e=>{n({to:e,search:e=>e,state:e=>({...e,view:"nav"})})},value:`/${t}`,children:[e.jsx(Pt,{className:"flex flex-1 border-orange-300 bg-orange-200 text-orange-800 hover:bg-orange-200 focus:ring-orange-300 dark:border-orange-700/50 dark:bg-orange-800 dark:text-orange-200 dark:hover:bg-orange-800",children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(It,{placeholder:"Navigate"}),a===t&&e.jsx(p,{className:"animate-spin",icon:x,size:20})]})}),e.jsx(Tt,{children:le.filter(e=>e.showMobile).map(t=>e.jsx(Dt,{className:"data-[state=checked]:bg-orange-300 data-[state=checked]:text-orange-900 dark:data-[state=checked]:bg-orange-800 dark:data-[state=checked]:text-white",value:t.href,children:e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(p,{icon:t.icon,size:18}),e.jsx("div",{children:t.label})]})},t.href))})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(u,{params:{category:t},search:e=>e,state:e=>"post"===e.view&&""!==r?{...e,view:"nav"}:{...e,view:"nav"===e.view?"post":"nav"},to:"/$category",children:e.jsx(B,{variant:"outline",children:"post"===o?e.jsx(p,{icon:h}):e.jsx(p,{icon:V})})})})]})}function Mt({posts:t,category:r,hasNextPage:a,activePostId:o,isFetchingNextPage:n,fetchNextPage:s,error:i,onPostClick:l}){const c=H();return e.jsxs(e.Fragment,{children:[t.map(t=>e.jsxs("div",{className:f("min-h-16 w-full border-gray-200 border-b p-3 text-left text-sm hover:bg-zinc-100 dark:border-gray-700 dark:hover:bg-zinc-800",o===t.id&&"border-orange-700/70 bg-orange-50 hover:bg-orange-50 dark:border-orange-700/70 dark:bg-orange-50/10 dark:hover:bg-orange-50/10"),onClick:()=>{l?.(),c({params:{category:r||"top",postId:`${K(t.title)}-${t.id}`},state:e=>({...e,view:"post"}),to:"/$category/$postId"})},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l?.(),c({to:"/$category/$postId",params:{category:r||"top",postId:`${K(t.title)}-${t.id}`}}))},role:"button",tabIndex:0,children:[e.jsx(u,{className:"text-black hover:text-orange-700 dark:text-white dark:hover:text-orange-300",onClick:e=>{t.url&&(e.stopPropagation(),l?.())},params:{category:r||"top",postId:`${K(t.title)}-${t.id}`},rel:t.url?"noopener noreferrer":void 0,state:e=>({...e,view:"post"}),target:t.url?"_blank":"_self",to:t.url?t.url:"/$category/$postId",children:e.jsx("span",{children:t.title})}),e.jsxs("div",{className:f("mt-1 flex items-center justify-between gap-2 text-gray-500 text-xs"),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{icon:W,size:16})," ",t.score," ","points"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(u,{className:"flex items-center gap-1",onClick:()=>{l?.()},params:{category:r||"top",postId:`${K(t.title)}-${t.id}`},to:"/$category/$postId",children:[e.jsx(p,{icon:q,size:16})," ",t.descendants]})})]})]},t.id)),a&&e.jsx("div",{className:"p-3",children:e.jsx(B,{className:"w-full",disabled:n,onClick:s,size:"sm",type:"button",variant:"orange",children:n?e.jsx(p,{className:"animate-spin",icon:x,size:16}):"Load More Posts"})}),i&&e.jsx("div",{className:"border-gray-200 border-b p-3 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-sm border border-red-200 bg-red-50 p-3 text-red-700 text-sm dark:border-red-700 dark:bg-red-950 dark:text-red-300",children:[e.jsx(p,{icon:U,size:16}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Failed to load more posts"}),e.jsx("div",{className:"text-red-600 text-xs dark:text-red-300",children:"Some posts may be temporarily unavailable"})]}),s&&e.jsx(B,{onClick:s,size:"sm",type:"button",variant:"outline",children:"Retry"})]})}),!(a||i)&&s&&e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:"That's all"})]})}function Lt({className:t,...r}){return e.jsx("div",{className:f("animate-pulse rounded-md bg-primary/10 dark:bg-black/20",t),...r})}t.forwardRef(({className:t,...r},a)=>e.jsx(St,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",t),...r})).displayName=St.displayName;function zt(){const{pathname:n}=se(),s=r({select:e=>e.location.state?.view}),i=n.split("/"),l=i[1]||"top",c=i[2]||"",d=c?.split("-").pop(),u=X.useLoaderData(),p=a(Y,e=>e.compactMode),h=u.category===l,{posts:m,fetchNextPage:g,hasNextPage:x,isFetchingNextPage:v,isLoading:w,error:y}=(({category:e,initialPosts:t=[],remainingItems:r=[]})=>{const a=Q(),{data:o,fetchNextPage:n,isFetching:s,isFetchingNextPage:i,isLoading:l,error:c,hasNextPage:d}=ie({queryKey:["infinite-posts",e],queryFn:async({pageParam:t=0,queryKey:r,signal:o})=>{if(0===t){const t=await G(e,{signal:o});return{posts:t.first10,remainingItems:t.remainingItems,pageIndex:0}}const n=a.getQueryData(r),s=n?.pages[0];if(!s?.remainingItems)return{posts:[],remainingItems:[],pageIndex:t};const i=t-1,l=s.remainingItems[i];if(!l)return{posts:[],remainingItems:s.remainingItems,pageIndex:t};const c=await J(l,{signal:o}),{posts:d,failedIds:u=[]}=c;return u.length>0&&a.setQueryData(["infinite-posts",e],e=>{if(!e?.pages?.[0])return e;const t=[...e.pages],r={...t[0]};return r.remainingItems=[...r.remainingItems,u],t[0]=r,{...e,pages:t}}),{posts:d,remainingItems:s.remainingItems,pageIndex:t,failedIds:u}},initialPageParam:0,initialData:t.length>0&&r.length>0?{pages:[{posts:t,remainingItems:r,pageIndex:0,failedIds:[]}],pageParams:[0]}:void 0,getNextPageParam:t=>{const r=a.getQueryData(["infinite-posts",e]),o=r?.pages?.[0];if(!o?.remainingItems)return;const n=t.pageIndex+1;return n<=o.remainingItems.length?n:void 0},staleTime:3e5,gcTime:18e5});return{posts:o?.pages?.flatMap(e=>e.posts)||[],fetchNextPage:n,isFetching:s,isLoading:l,hasNextPage:d,isFetchingNextPage:i,error:c}})({category:l,initialPosts:h?u.first10:[],remainingItems:h?u.remainingItems:[]}),[b,j]=t.useState(!1),N=H();return t.useEffect(()=>{j("nav"===s)},[s]),e.jsxs("div",{className:f("flex h-dvh flex-col overflow-hidden bg-zinc-50 md:flex-row dark:bg-black",p&&"mx-auto w-full max-w-6xl border-black/20 border-r border-l dark:border-white/20"),children:[b&&e.jsx("div",{className:"fixed top-0 right-0 bottom-16 left-0 z-40 h-[calc(100dvh-3.3rem)] md:hidden",children:e.jsx("div",{className:"absolute top-0 right-0 bottom-16 left-0 h-full bg-white dark:bg-zinc-900",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex items-center justify-between border-gray-200 border-b p-2 dark:border-zinc-800",children:e.jsx("h2",{className:"px-1 font-medium text-lg",children:l.charAt(0).toUpperCase()+l.slice(1)})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:w?e.jsx(Ft,{}):e.jsx(Mt,{activePostId:d?Number(d):void 0,category:l,error:y,fetchNextPage:g,hasNextPage:x,isFetchingNextPage:v,onPostClick:()=>N({to:".",search:e=>({...e})}),posts:m})})]})})}),e.jsx("div",{className:"hidden flex-col border-gray-200 border-r bg-white md:flex dark:border-zinc-800 dark:bg-zinc-900",children:e.jsx(ce,{category:l,isLoadingCategory:w?l:null,postId:c})}),e.jsx("div",{className:"hidden w-1/4 min-w-[300px] overflow-y-auto border-gray-200 border-r bg-white md:block dark:border-zinc-800 dark:bg-zinc-900",children:w?e.jsx(Ft,{}):e.jsx(Mt,{activePostId:Number(d),category:l,error:y,fetchNextPage:g,hasNextPage:x,isFetchingNextPage:v,onPostClick:()=>N({to:".",search:e=>({...e})}),posts:m})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(o,{})}),e.jsx(Et,{category:l,isLoadingCategory:w?l:null,postId:c,view:b?"post":"nav"})]})}function Ft(){return e.jsx("div",{className:"flex flex-col items-center justify-center gap-2",children:Array.from({length:10}).map((t,r)=>e.jsxs("div",{className:"flex w-full flex-col gap-2 border-gray-200 border-b p-2 dark:border-zinc-800",children:[e.jsx(Lt,{className:"h-10 w-full rounded-md"}),e.jsx(Lt,{className:"h-4 w-3/4 rounded-md"})]},r.toString()))})}export{zt as component};
